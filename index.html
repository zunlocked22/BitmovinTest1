<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Smart IPTV</title>
  <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.7.6/dist/shaka-player.compiled.min.js"></script>
  <style>
    body { background: #111; color: white; font-family: Arial; text-align: center; }
    #video { width: 80%; height: 500px; border: 2px solid #00ffff; margin-top: 20px; }
    select { margin-top: 20px; font-size: 18px; padding: 5px 10px; }
  </style>
</head>
<body>
  <h1>AZ IPTV</h1>
  <select id="channel">
    <option value="gma">GMA 7 (via Worker)</option>
    <option value="crave1">Crave 1 (ClearKey)</option>
  </select>
  <video id="video" autoplay controls></video>

  <script>
    const player = new shaka.Player(document.getElementById('video'));

    const channels = {
      gma: {
        manifestUri: 'https://shiny-recipe-55cd.aizenzazel00.workers.dev',
        drm: {
          servers: {
            'com.widevine.alpha': 'http://143.44.136.74:9443/widevine/?deviceId=02:00:00:00:00:00'
          }
        }
      },
      crave1: {
        manifestUri: 'https://live-crave.video.9c9media.com/137c6e2e72e1bf67b82614c7c9b216d6f3a8c8281748505659713/fe/f/crave/crave1/manifest.mpd',
        drm: {
          clearKeys: {
            '4a107945066f45a9af2c32ea88be60f4': 'df97e849d68479ec16e395feda7627d0'
          }
        }
      }
    };

    async function loadChannel(key) {
      const cfg = channels[key];
      player.configure({ drm: cfg.drm });
      try {
        await player.load(cfg.manifestUri);
        console.log('Playing:', key);
      } catch (e) {
        console.error('Error loading', key, e);
        alert('Error loading stream: ' + key);
      }
    }

    document.getElementById('channel').addEventListener('change', e => {
      loadChannel(e.target.value);
    });

    shaka.polyfill.installAll();
    loadChannel('gma');
  </script>
</body>
</html>
